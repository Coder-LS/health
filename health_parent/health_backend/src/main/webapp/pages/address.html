<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script type="text/javascript" src="//api.map.baidu.com/api?type=webgl&v=1.0&ak=PYH21zPQQ7ZiVklmXXdpevbPhv7k8V5T"></script>
    <script src="https://code.bdstatic.com/npm/jquery@1.12.4/dist/jquery.min.js"></script>
    <title>逆地址解析</title>
    <style>
        body,html{
            width: 100%;
            height: 100%;
            padding: 0;
            margin: 0;
        }
        #container{
            width: 100%;
            height: 100%;
            overflow: hidden;
        }
        #result{
            position: fixed;
            top: 10px;
            left: 10px;
            padding: 0px 7px;
            min-width: 350px;
            height: 70px;
            line-height: 35px;
            background: #fff;
            box-shadow: 0 2px 6px 0 rgba(27, 142, 236, 0.5);
            border-radius: 7px;
            z-index: 99;
        }
    </style>
</head>
<body>

<div id='container'></div>
<!--<div id='result'>-->
<!--    点击展示详细的地址：-->
<!--    <div id='result_l'></div>-->
<!--</div>-->
<script>
    //el-table__body
    //window.onload=function(){

    var addressDataStr = window.parent.document.getElementsByName("dataList")[0].getElementsByClassName("el-table__body")[0].getElementsByClassName("addressName");
    // 11上海虹桥国际机场121.34536743164062 31.19283276425548删除222上海市黄浦区上海大剧院121.47839931.235344删除323上海市黄浦区上海博物馆121.4822331.234143删除

    // var addressName = addressDataStr.replace(/[^\u4e00-\u9fa5]/gi, "").split("删除");
    // addressName.pop();
    //
    var addressName = [];
    var lat = [];
    var lng = [];
    //
    //var latlngList=addressDataStr.split("删除");
    //latlngList.pop();
    for (let i = 0; i < addressDataStr.length; i++) {
        addressName[i]= addressDataStr[i].innerText;
    }
    console.log(addressName);

    //经度
    var lngDataStr = window.parent.document.getElementsByName("dataList")[0].getElementsByClassName("el-table__body")[0].getElementsByClassName("longitude");
    for (let i = 0; i < addressDataStr.length; i++) {
        lng[i]= lngDataStr[i].innerText;
    }
    console.log(lng);

    //纬度
    var latDataStr = window.parent.document.getElementsByName("dataList")[0].getElementsByClassName("el-table__body")[0].getElementsByClassName("latitude");
    for (let i = 0; i < addressDataStr.length; i++) {
        lat[i]= latDataStr[i].innerText;
    }
    console.log(lat);

    //}


    // //父页面的属性和方法必须在iframe标签之前
    // var test1 = parent.p;
    // console.log(test1);

    //实例化地图
    var map = new BMapGL.Map('container');
    //map.centerAndZoom(new BMapGL.Point(121.34262084960938,31.188721039313997), 12);
    map.centerAndZoom('上海市', 12); // 初始化地图,设置中心点坐标和地图级别
    map.enableScrollWheelZoom(true); // 开启鼠标滚轮缩放

    map.enableScrollWheelZoom();
    //设置地图显示元素
    map.setDisplayOptions({
        poi: true       //是否显示POI信息
    })

    for (let i = 0; i < addressName.length; i++) {

        var geoc = new BMapGL.Geocoder();

            //map.addEventListener('click', function(e) {
                //var pt = e.latlng;
                var pt = '';
                var marker = new BMapGL.Marker(new BMapGL.Point(lng[i], lat[i]));
                map.addOverlay(marker);

                geoc.getLocation(pt, function (rs) {
                    //var addComp = rs.addressComponents;

                    //var addressName = rs.surroundingPois;
                    //var addressName = rs.address;

                    var opts = {
                        position: new BMapGL.Point(lng[i], lat[i]), // 指定文本标注所在的地理位置
                        offset: new BMapGL.Size(30, -30) // 设置文本偏移量
                    };
                    // 创建文本标注对象
                    //var label = new BMapGL.Label(addComp.province + ", " + addComp.city + ", " + addComp.district + ", " + addComp.street + ", " + addComp.streetNumber, opts);
                    var label = new BMapGL.Label(addressName[i], opts);

                    // 自定义文本标注样式
                    label.setStyle({
                        color: 'blue',
                        border: true,
                        borderRadius: '30px',
                        borderColor: '#ccc',
                        backgroundColor: 'yellow',
                        padding: '10px',
                        fontSize: '16px',
                        height: '30px',
                        lineHeight: '30px',
                        fontFamily: '微软雅黑'
                    });
                    map.addOverlay(label);
                })
    }


</script>
</body>
</html>